fixing up the code.

working branch is develop-make-recursive
